========================================================================
SEASONS & STARS TEST SUITE ORGANIZATION - QUICK REFERENCE
========================================================================

CURRENT STATE:
- 149 total test files
- 2,792 test cases (describe/it blocks)
- 147 files in packages/core/test/
- 2 files in packages/core/test-headless/
- Primarily flat structure at test root level

========================================================================
TEST DISTRIBUTION BY FEATURE
========================================================================

Mini Widget            [████████] 8 files
Calendar Engine        [████████] 8 files
Calendar Manager       [███████] 7 files
Other Features         [███████████████████████████████] ~70+ files

Top Features:
  - Calendar Engine: error-handling, leap-year, worldtime, etc.
  - Calendar Manager: hook-payload, module-flags, lazy-events, etc.
  - Mini Widget: day-display, time-advancement, settings-integration, etc.
  - Date Formatter: 4 files (basic, integration, advanced, edge-cases)
  - Intercalary Days: 10 files (format resolution, round-trip, UI workflows)
  - Events/Notes: 8+ files (API, permissions, recurrence, multi-day)
  - Widgets: 9 files (type-resolver, none-option, sync, factory, etc.)

========================================================================
ORGANIZATION PATTERNS
========================================================================

NAMING CONVENTION (Feature-Based):
  ✓ calendar-engine.test.ts              → Basic unit tests
  ✓ calendar-engine-error-handling.test.ts  → Feature aspect
  ✓ calendar-engine-leap-year-regression.test.ts → Regression/bug fix
  ✓ intercalary-format-resolution.test.ts → Specific scenario

SOURCE-TO-TEST MAPPING (Indirect):
  src/core/calendar-engine.ts
    ↔ test/calendar-engine.test.ts
    ↔ test/calendar-engine-error-handling.test.ts
    ↔ test/calendar-engine-leap-year-regression.test.ts
    ↔ test/calendar-engine-negative-leap-days.test.ts
    ↔ test/calendar-engine-optional-leap-year.test.ts
    ↔ test/calendar-engine-world-creation-timestamp.test.ts
    ↔ test/calendar-engine-worldtime-interpretation-regression.test.ts

  src/ui/calendar-mini-widget.ts
    ↔ test/mini-widget-day-display.test.ts
    ↔ test/mini-widget-time-advancement.test.ts
    ↔ test/mini-widget-settings-integration.test.ts
    ↔ test/mini-widget-sunrise-sunset-click.test.ts
    ↔ test/mini-widget-moon-phases.test.ts
    ↔ test/mini-widget-compact-mode.test.ts
    ↔ test/mini-widget-pinned-position.test.ts
    ↔ test/mini-widget-time-display.test.ts
    ↔ test/ui/calendar-mini-widget.test.ts

  Problem: Not obvious which tests map to which source files

TEST STRUCTURE (By Type - Estimated):
  Unit Tests (40%)           ← Tests isolating single modules
  Integration Tests (50%)    ← Tests involving multiple modules
  Regression Tests (10%)     ← Tests for specific bugs

========================================================================
SUBDIRECTORY USAGE (Minimal)
========================================================================

test/
  ├── 145 .test.ts files (ROOT LEVEL - FLAT STRUCTURE)
  ├── test-helpers/     → 1 file (foundry-mocks.ts)
  ├── utils/           → 3 files (calendar-loader.ts, mock-calendar-fetch.ts, test-logger.ts)
  ├── mocks/           → 1 file (calendar-mocks.ts)
  ├── calendars/       → 1 file (cross-calendar-consistency.test.ts)
  └── ui/              → 1 file (calendar-mini-widget.test.ts)

Problem: Only 2 of 147 test files use subdirectories

========================================================================
ORGANIZATION CHALLENGES
========================================================================

1. FLAT STRUCTURE NAVIGATION
   ⚠ 145 test files at root makes directory overwhelming
   ⚠ Difficult to find related tests quickly
   ⚠ No visual grouping by component or feature

2. SOURCE-TEST CORRESPONDENCE
   ⚠ Tests don't mirror src/ directory structure
   ⚠ One source file = multiple test files (no clear pattern)
   ⚠ Hard to answer: "What tests cover calendar-manager.ts?"

3. MIXED TEST TYPES WITHOUT SEPARATION
   ⚠ Unit, integration, and regression tests all at root level
   ⚠ Naming doesn't indicate test type
   ⚠ Hard to run just unit tests or just integration tests

4. REGRESSION TEST PROLIFERATION
   ⚠ Multiple regression tests for same module
   ⚠ No clear distinction between core tests and bug fixes
   ⚠ Example: 10 intercalary-related tests scattered across root

5. UI TESTS SCATTERED
   ⚠ Only 1 UI test in test/ui/ subdirectory
   ⚠ Most UI tests at root level (create-note-window.test.ts, etc.)
   ⚠ Inconsistent organization of UI component tests

========================================================================
ORGANIZATION STRENGTHS
========================================================================

✓ CONSISTENT NAMING
  → Feature-based names are clear and predictable
  → Easy to find tests by feature name

✓ GOOD TEST ISOLATION
  → Comprehensive Foundry mocks in setup.ts
  → Tests run independently without state pollution

✓ LOGICAL GROUPING BY PREFIX
  → Similar tests naturally cluster (mini-widget*, calendar-engine*, etc.)
  → Easy to scan for related tests

✓ DEDICATED SUPPORT INFRASTRUCTURE
  → test-helpers/, utils/, mocks/ for shared code
  → Clean separation of test support files

========================================================================
TEST INFRASTRUCTURE
========================================================================

Framework:     Vitest with jsdom environment
Globals:       describe/it/expect available without imports
Setup File:    ./packages/core/test/setup.ts
Mocks:         Custom MockHooks, MockApplicationV2, MockCalendarData
Coverage:      V8 provider with 80% thresholds
CI:            JUnit XML reporter for GitHub Actions
Headless:      Playwright for browser-based integration tests

Mock Infrastructure:
  - Foundry game object with settings, time, user, modules
  - Functional Hooks system (on, once, off, callAll)
  - PF2e environment setup utilities
  - Handlebars template engine mock
  - Console spy setup to silence test output

========================================================================
REORGANIZATION OPPORTUNITIES
========================================================================

OPTION A: Directory-Based (Mirror src/ structure)
  test/
    ├── core/
    │   ├── calendar-engine.test.ts
    │   ├── calendar-engine/
    │   │   ├── error-handling.test.ts
    │   │   ├── leap-year-regression.test.ts
    │   │   └── ...
    │   ├── calendar-manager.test.ts
    │   ├── calendar-manager/
    │   │   ├── hook-payload.test.ts
    │   │   ├── module-flags.test.ts
    │   │   └── ...
    │   ├── date-formatter.test.ts
    │   └── ...
    ├── ui/
    │   ├── calendar-mini-widget.test.ts
    │   ├── calendar-mini-widget/
    │   │   ├── day-display.test.ts
    │   │   ├── time-advancement.test.ts
    │   │   └── ...
    │   └── ...
    └── integration/

OPTION B: Type-Based (Unit/Integration/Regression)
  test/
    ├── unit/
    │   ├── calendar-engine.test.ts
    │   ├── date-formatter.test.ts
    │   └── ...
    ├── integration/
    │   ├── calendar-manager-hook-payload.test.ts
    │   ├── ui-integration.test.ts
    │   └── ...
    ├── regression/
    │   ├── calendar-engine-leap-year-regression.test.ts
    │   ├── gregorian-weekday-bug.test.ts
    │   └── ...
    └── headless/

OPTION C: Hybrid (Component-based with sub-directories for test type)
  test/
    ├── calendar-engine/
    │   ├── unit.test.ts
    │   ├── error-handling.test.ts
    │   ├── regressions/
    │   │   ├── leap-year.test.ts
    │   │   └── negative-leap.test.ts
    │   └── ...
    ├── calendar-manager/
    │   ├── unit.test.ts
    │   ├── hook-integration.test.ts
    │   └── ...
    └── ...

OPTION D: Hybrid (Type-based with feature sub-organization)
  test/
    ├── unit/
    │   ├── calendar-engine/
    │   │   └── index.test.ts
    │   ├── date-formatter/
    │   │   └── index.test.ts
    │   └── ...
    ├── integration/
    │   ├── calendar-manager/
    │   │   └── hooks.test.ts
    │   ├── ui/
    │   │   └── integration.test.ts
    │   └── ...
    └── regression/
        ├── calendar-engine/
        │   ├── leap-year.test.ts
        │   └── ...
        └── ...

========================================================================
KEY STATISTICS
========================================================================

File Count:
  - Total test files: 149
  - Root level tests: 145 (97%)
  - Subdirectory tests: 4 (3%)
  - Test cases: 2,792

Source Code:
  - Total source files: 60+
  - core/src/ files: 38
  - core/src/ui/ files: 14
  - Test-to-source ratio: ~2.5:1

Coverage:
  - Threshold: 80% (branches, functions, lines, statements)
  - Scope: core/src, pf2e-pack/src, custom-calendar-builder/src

========================================================================
RELATED TEST GUIDELINES (from CLAUDE.md)
========================================================================

✓ Each test file targets a single source module or workflow
✓ No conditional logic in tests (if/switch/ternary)
✓ Use deterministic data (no random values)
✓ Assertions must be explicit and exact
✓ Prefer real functionality over mocks when feasible
✓ Unit tests isolate one source file
✓ Integration/regression tests cover complete workflows
✓ Keep tests self-contained with no external state
✓ Run tests before committing: npm run test:run

========================================================================
