#!/usr/bin/env node

/**
 * Generate TypeScript module from gregorian.json
 * This ensures browser compatibility while maintaining single source of truth
 */

import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const gregorianJsonPath = path.join(__dirname, '../packages/core/calendars/gregorian.json');
const outputPath = path.join(__dirname, '../packages/core/src/core/gregorian-defaults.ts');

function generateTypeScriptModule() {
  try {
    // Read the JSON file
    const gregorianData = JSON.parse(fs.readFileSync(gregorianJsonPath, 'utf8'));

    // Generate TypeScript module content
    const tsContent = `/**
 * Generated gregorian calendar defaults for fallback values
 * THIS FILE IS AUTO-GENERATED - DO NOT EDIT MANUALLY
 * Source: packages/core/calendars/gregorian.json
 * Generated by: scripts/generate-gregorian-defaults.js
 */
import type { SeasonsStarsCalendar } from '../types/calendar';

export const GREGORIAN_DEFAULTS: SeasonsStarsCalendar = ${JSON.stringify(gregorianData, null, 2)} as const;
`;

    // Write the TypeScript file
    fs.writeFileSync(outputPath, tsContent, 'utf8');
    console.log(`✅ Generated ${outputPath} from ${gregorianJsonPath}`);
  } catch (error) {
    console.error('❌ Error generating gregorian defaults:', error);
    process.exit(1);
  }
}

generateTypeScriptModule();
