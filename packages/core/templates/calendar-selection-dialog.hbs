<div class="dialog-content calendar-selection-master-detail">
  <div class="calendar-selection-header flexcol">
    <div class="header-title flexrow">
      <span class="header-icon">
        <i class="fas fa-calendar-alt"></i>
      </span>
      <div class="header-text flexcol">
        <h1>{{localize 'SEASONS_STARS.dialog.calendar_selection.choose_calendar'}}</h1>
        <p class="header-description">
          {{localize 'SEASONS_STARS.dialog.calendar_selection.choose_hint'}}
        </p>
      </div>
    </div>
  </div>
  {{#if calendarGroups.length}}
  <div class="calendar-browser flexrow">
    <div class="calendar-list-panel flexcol">
      <div class="calendar-controls flexcol">
        <div class="search-section">
          <input
            type="text"
            class="calendar-search"
            placeholder="{{localize 'SEASONS_STARS.dialog.calendar_selection.search_placeholder'}}"
            value="{{searchQuery}}"
            disabled
          />
        </div>

        <div class="filter-section flexrow">
          <div class="filter-group">
            <label>{{localize 'SEASONS_STARS.dialog.calendar_selection.filter_source_label'}}</label>
            <div class="multi-select-dropdown disabled">
              <button type="button" class="multi-select-trigger" disabled>
                <span class="selected-text">{{localize 'SEASONS_STARS.dialog.calendar_selection.filter_source_all'}}</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div class="multi-select-options">
                {{#each calendarGroups}}
                <label class="multi-select-option">
                  <input type="checkbox" value="{{id}}" disabled />
                  <span>{{label}}</span>
                </label>
                {{/each}}
              </div>
            </div>
          </div>

          <div class="filter-group">
            <label>{{localize 'SEASONS_STARS.dialog.calendar_selection.filter_tags_label'}}</label>
            <input
              type="text"
              class="tag-filter-input"
              placeholder="{{localize 'SEASONS_STARS.dialog.calendar_selection.filter_tags_placeholder'}}"
              value="{{tagFilter}}"
              disabled
            />
          </div>
        </div>

        <div class="filter-status">
          <span class="results-count">
            {{localize 'SEASONS_STARS.dialog.calendar_selection.results_count' count=resultsCount}}
          </span>
          <button
            type="button"
            class="clear-filters {{#unless filtersActive}}hidden{{/unless}}"
            data-action="clearFilters"
            disabled
          >
            <i class="fas fa-times"></i>
            {{localize 'SEASONS_STARS.dialog.calendar_selection.clear_filters'}}
          </button>
        </div>
      </div>

      <div class="calendar-list scrollable">
        {{#each calendarGroups}}
        <div class="calendar-group">
          <div class="group-header">
            <i class="{{icon}} source-icon"></i>
            <span class="source-name">{{label}}</span>
            <span class="calendar-count">({{calendarCount}})</span>
          </div>

          <div class="calendar-items">
            {{#each calendars}}
            <div
              class="calendar-item ui-control {{#if isCurrent}}current{{/if}} {{#if isSelected}}selected{{/if}} {{#if hierarchyLevel}}hierarchy-level-{{hierarchyLevel}}{{/if}} {{#if isFilePicker}}file-picker{{/if}}"
              data-action="selectCalendar"
              data-calendar-id="{{id}}"
              tabindex="0"
            >
              <div class="calendar-item-content flexrow">
                <div class="calendar-icon">
                  <i class="{{sourceIcon}}"></i>
                </div>

                <div class="calendar-info flexcol">
                  <div class="calendar-name">{{label}}</div>
                  {{#if variantInfo}}
                  <div class="variant-info">{{variantInfo}}</div>
                  {{/if}}
                  {{#if setting}}
                  <div class="calendar-setting">{{setting}}</div>
                  {{/if}}
                  {{#if tags.length}}
                  <div class="calendar-tags">
                    {{#each tags}}
                    <span class="tag">{{this}}</span>
                    {{/each}}
                  </div>
                  {{/if}}
                </div>

                {{#if isCurrent}}
                <div class="current-indicator" data-tooltip="{{localize 'SEASONS_STARS.dialog.calendar_selection.current'}}">
                  <i class="fas fa-check-circle"></i>
                </div>
                {{/if}}
              </div>
            </div>
            {{/each}}
          </div>
        </div>
        {{/each}}
      </div>

      <div class="custom-calendar-actions">
        <button type="button" class="add-custom-calendar" data-action="openFilePicker">
          <i class="fas fa-plus"></i>
          {{localize 'SEASONS_STARS.dialog.calendar_selection.add_custom_calendar'}}
        </button>
      </div>
    </div>

    <div class="calendar-details-panel flexcol">
      <div class="calendar-details scrollable">
        {{#if selectedCalendarDetails}}
        <div class="details-header flexcol">
          <h3 class="calendar-title">{{selectedCalendarDetails.label}}</h3>
          {{#if selectedCalendarDetails.author}}
          <div class="calendar-author">
            <i class="fas fa-user"></i>
            <span>{{selectedCalendarDetails.author}}</span>
          </div>
          {{/if}}
          <div class="calendar-source">
            <i class="{{selectedCalendarDetails.sourceIcon}} source-icon"></i>
            <span>{{selectedCalendarDetails.sourceLabel}}</span>
          </div>
        </div>

        <div class="details-section">
          <h4>{{localize 'SEASONS_STARS.dialog.calendar_selection.description_header'}}</h4>
          <p class="calendar-description">{{selectedCalendarDetails.description}}</p>
        </div>

        {{#if selectedCalendarDetails.tags.length}}
        <div class="details-section">
          <h4>{{localize 'SEASONS_STARS.dialog.calendar_selection.tags_header'}}</h4>
          <div class="calendar-tags-display">
            {{#each selectedCalendarDetails.tags}}
            <span class="tag">{{this}}</span>
            {{/each}}
          </div>
        </div>
        {{/if}}

        <div class="details-section">
          <h4>{{localize 'SEASONS_STARS.dialog.calendar_selection.preview_header'}}</h4>
          <div class="calendar-preview">
            <div class="sample-preview">
              <label>{{localize 'SEASONS_STARS.dialog.calendar_selection.preview_sample_label'}}</label>
              <div class="sample-date">{{selectedCalendarDetails.sampleDate}}</div>
            </div>

            {{#if selectedCalendarDetails.miniPreview}}
            <div class="mini-preview">
              <label>{{localize 'SEASONS_STARS.dialog.calendar_selection.preview_mini_label'}}</label>
              <div class="mini-format">{{selectedCalendarDetails.miniPreview}}</div>
            </div>
            {{/if}}
          </div>
        </div>

        {{else}}
        <div class="details-empty flexcol">
          <i class="fas fa-calendar-plus"></i>
          <p>{{localize 'SEASONS_STARS.dialog.calendar_selection.no_selection_message'}}</p>
        </div>
        {{/if}}

        {{#if selectedCalendarDetails}}
        <div class="details-actions">
          {{#if selectedCalendarDetails.canPreview}}
          <button
            type="button"
            class="button"
            data-action="previewCalendar"
            data-calendar-id="{{selectedCalendarDetails.id}}"
          >
            <i class="fas fa-eye"></i>
            {{localize 'SEASONS_STARS.dialog.calendar_selection.preview'}}
          </button>
          {{/if}}

          {{#if selectedCalendarDetails.isFilePicker}}
            {{#if selectedCalendarDetails.hasFile}}
            <button type="button" class="button" data-action="clearFilePicker">
              <i class="fas fa-times"></i>
              {{localize 'SEASONS_STARS.dialog.calendar_selection.clear'}}
            </button>
            {{else}}
            <button type="button" class="button" data-action="openFilePicker">
              <i class="fas fa-folder-open"></i>
              {{localize 'SEASONS_STARS.dialog.calendar_selection.browse'}}
            </button>
            {{/if}}
          {{/if}}
        </div>

        {{#if selectedCalendarDetails.isFilePicker}}
        <div class="details-section file-picker-status">
          <h4>{{localize 'SEASONS_STARS.dialog.calendar_selection.file_path'}}</h4>
          <div class="file-path">
            {{#if selectedCalendarDetails.selectedFilePath}}
            {{selectedCalendarDetails.selectedFilePath}}
            {{else}}
            {{localize 'SEASONS_STARS.dialog.calendar_selection.no_file_selected'}}
            {{/if}}
          </div>
        </div>
        {{/if}}
        {{/if}}
      </div>
    </div>
  </div>
  {{else}}
  <div class="no-calendars flexcol">
    <i class="fas fa-calendar-times no-calendars-icon"></i>
    <div class="no-calendars-message">
      <h4>{{localize 'SEASONS_STARS.dialog.calendar_selection.no_calendars'}}</h4>
      <p>{{localize 'SEASONS_STARS.dialog.calendar_selection.no_calendars_hint'}}</p>
    </div>
  </div>
  {{/if}}
</div>
